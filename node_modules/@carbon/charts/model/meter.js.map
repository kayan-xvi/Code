{"version":3,"file":"meter.js","sourceRoot":"","sources":["meter.ts"],"names":[],"mappings":"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","sourcesContent":["// Internal Imports\nimport * as Configuration from '../configuration';\nimport { ChartModel } from './model';\nimport * as Tools from '../tools';\n\n/** The meter chart model layer which extends some of the data setting options.\n * Meter only uses 1 dataset\n *  */\n\nexport class MeterChartModel extends ChartModel {\n\tconstructor(services: any) {\n\t\tsuper(services);\n\t}\n\n\tgetMaximumDomain(data) {\n\t\tconst max = data.reduce(\n\t\t\t(accumulator, datum) => accumulator + datum.value,\n\t\t\t0\n\t\t);\n\t\treturn max;\n\t}\n\n\t/**\n\t * Use a provided color for the bar or default to carbon color if no status provided.\n\t * Defaults to carbon color otherwise.\n\t * @param group dataset group label\n\t */\n\tgetFillColor(group: string) {\n\t\tconst options = this.getOptions();\n\t\tconst userProvidedScale = Tools.getProperty(options, 'color', 'scale');\n\t\tconst status = this.getStatus();\n\t\t// user provided a fill color or there isn't a status we can use the colorScale\n\t\tif (userProvidedScale || !status) {\n\t\t\treturn super.getFillColor(group);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Get the associated status for the data by checking the ranges\n\t */\n\tgetStatus() {\n\t\tconst options = this.getOptions();\n\t\tconst dataValues = Tools.getProperty(this.getDisplayData());\n\n\t\tconst { value: totalValue } = dataValues\n\t\t\t? dataValues.reduce((previous, current) => {\n\t\t\t\t\treturn { value: previous.value + current.value };\n\t\t\t  })\n\t\t\t: 0;\n\n\t\t// use max value if the percentage is bigger than 100%\n\t\tconst boundedValue = Tools.getProperty(options, 'meter', 'proportional')\n\t\t\t? totalValue\n\t\t\t: totalValue > 100\n\t\t\t? 100\n\t\t\t: totalValue;\n\n\t\t// user needs to supply ranges\n\t\tconst allRanges = Tools.getProperty(\n\t\t\toptions,\n\t\t\t'meter',\n\t\t\t'status',\n\t\t\t'ranges'\n\t\t);\n\n\t\tif (allRanges) {\n\t\t\tconst result = allRanges.filter(\n\t\t\t\t(step) =>\n\t\t\t\t\tstep.range[0] <= boundedValue &&\n\t\t\t\t\tboundedValue <= step.range[1]\n\t\t\t);\n\t\t\tif (result.length > 0) {\n\t\t\t\treturn result[0].status;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetTabularDataArray() {\n\t\tconst displayData = this.getDisplayData();\n\t\tconst options = this.getOptions();\n\t\tconst { groupMapsTo } = options.data;\n\t\tconst status = this.getStatus();\n\t\tconst proportional = Tools.getProperty(\n\t\t\toptions,\n\t\t\t'meter',\n\t\t\t'proportional'\n\t\t);\n\n\t\tlet result = [];\n\t\tlet domainMax;\n\t\t// Display the appropriate columns and fields depending on the type of meter\n\t\tif (proportional === null) {\n\t\t\tdomainMax = 100;\n\t\t\tconst datum = displayData[0];\n\n\t\t\tresult = [\n\t\t\t\t['Group', 'Value', ...(status ? ['Status'] : [])],\n\t\t\t\t[\n\t\t\t\t\tdatum[groupMapsTo],\n\t\t\t\t\tdatum['value'],\n\t\t\t\t\t...(status ? [status] : []),\n\t\t\t\t],\n\t\t\t];\n\t\t} else {\n\t\t\tconst total = Tools.getProperty(proportional, 'total');\n\t\t\tdomainMax = total ? total : this.getMaximumDomain(displayData);\n\n\t\t\tresult = [\n\t\t\t\t['Group', 'Value', 'Percentage of total'],\n\t\t\t\t...displayData.map((datum) => [\n\t\t\t\t\tdatum[groupMapsTo],\n\t\t\t\t\tdatum['value'],\n\t\t\t\t\t((datum['value'] / domainMax) * 100).toFixed(2) + ' %',\n\t\t\t\t]),\n\t\t\t];\n\t\t}\n\n\t\treturn result;\n\t}\n}\n"]}